<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guide to Refinancing Your Mortgage — MyMortgageExpert</title>
  <meta name="description" content="Everything you need to know about refinancing your mortgage in Canada — when to refinance, costs, benefits, and how to get started.">
  <link rel="stylesheet" href="../styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@800&family=Playfair+Display:ital,wght@1,600;1,700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- ======= NAV BAR ======= -->
  <header class="navbar" id="navbar">
    <div class="container navbar__inner">
      <a href="/" class="navbar__logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="7" fill="#1B3C2D"/>
          <path d="M7 23V13l9-5.5 9 5.5v10H7z" fill="#2A7D5B"/>
          <rect x="12.5" y="16.5" width="7" height="6.5" rx="1" fill="#F7F3EE"/>
        </svg>
        <span>MyMortgageExpert</span>
      </a>
      <nav class="navbar__links" id="navLinks">
        <div class="navbar__dropdown">
          <button class="navbar__dropdown-toggle">Calculators <svg width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
          <div class="navbar__dropdown-menu">
            <a href="/calculators/heloc.html">HELOC Calculator</a>
            <a href="/calculators/refinance.html">Refinance Calculator</a>
            <a href="/calculators/renewal.html">Renewal Calculator</a>
            <a href="/calculators/home-equity-loan.html">Home Equity Loan Calculator</a>
            <a href="/calculators/self-employed.html">Self-Employed Calculator</a>
            <a href="/calculators/land-transfer-tax.html">Land Transfer Tax Calculator</a>
            <a href="/calculators/purchase.html">Purchase Calculator</a>
            <a href="/calculators/affordability.html">Affordability Calculator</a>
          </div>
        </div>
        <a href="/mortgages.html">Mortgages</a>
        <a href="/how-it-works.html">How It Works</a>
        <a href="/about.html">About Us</a>
        <a href="#" class="btn btn--primary navbar__mobile-cta open-modal">Get Pre-Approved</a>
      </nav>
      <div class="navbar__right">
        <a href="#" class="btn btn--primary navbar__cta open-modal">Get Pre-Approved</a>
      </div>
      <button class="navbar__hamburger" id="hamburger" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <!-- ======= ARTICLE ======= -->
  <article class="article">
    <div class="container article__container">
      <div class="article__nav">
        <a href="first-time-home-buyer.html" class="article__back">&larr; First-Time Buyer Guide</a>
        <a href="mortgage-renewal.html" class="article__next">Renewal Guide &rarr;</a>
      </div>
      <div class="article__header">
        <span class="article__tag">MORTGAGE GUIDE</span>
        <h1 class="article__title">The Complete Guide to Refinancing Your Mortgage in Canada</h1>
        <div class="article__meta">
          <span>Updated February 2026</span>
          <span>&middot;</span>
          <span>10 min read</span>
        </div>
      </div>

      <div class="article__body">
        <p>Refinancing your mortgage means replacing your current mortgage with a new one &mdash; typically to take advantage of a lower interest rate, access your home equity, or change your mortgage terms. It's one of the most powerful financial tools available to Canadian homeowners, but it's not always the right move. This guide breaks down when refinancing makes sense, what it costs, and how to do it.</p>

        <h2>Why Do Homeowners Refinance?</h2>
        <p>There are several common reasons Canadians choose to refinance:</p>
        <ul>
          <li><strong>Lower your interest rate.</strong> If rates have dropped since you signed your mortgage, refinancing could reduce your monthly payment and save you thousands in interest over the life of the loan.</li>
          <li><strong>Consolidate high-interest debt.</strong> Rolling credit card balances, car loans, or lines of credit into your mortgage can dramatically reduce your overall interest costs. Mortgage rates are typically much lower than credit card rates (4-5% vs. 20%+).</li>
          <li><strong>Access your home equity.</strong> If your home has increased in value, you can borrow up to 80% of its current appraised value (minus your existing mortgage balance). This is common for home renovations, investments, or major expenses.</li>
          <li><strong>Change your mortgage term or type.</strong> Switch from variable to fixed (or vice versa), shorten your amortization, or adjust your payment schedule.</li>
        </ul>

        <h2>How Much Can You Borrow?</h2>
        <p>When refinancing, you can borrow up to 80% of your home's current appraised value, minus what you still owe. This is known as your loan-to-value (LTV) ratio.</p>
        <p>For example, if your home is worth $800,000 and you owe $400,000:</p>
        <ul>
          <li>Maximum mortgage: $800,000 &times; 80% = $640,000</li>
          <li>Available equity: $640,000 &minus; $400,000 = $240,000</li>
        </ul>
        <p>You could refinance up to $640,000 and receive up to $240,000 in cash (minus any fees). Use our <a href="/calculators/refinance.html" style="color: #2A7D5B; font-weight: 600;">Refinance Calculator</a> to estimate your numbers.</p>

        <h2>What Does Refinancing Cost?</h2>
        <p>Refinancing isn't free. You'll want to factor in these costs to make sure the savings outweigh the expenses:</p>
        <ul>
          <li><strong>Prepayment penalty:</strong> If you break your mortgage mid-term, your lender will charge a penalty. For variable-rate mortgages, this is typically 3 months' interest. For fixed-rate mortgages, it's the greater of 3 months' interest or the Interest Rate Differential (IRD) &mdash; which can be substantial.</li>
          <li><strong>Appraisal fee:</strong> $300 to $500 for a professional property appraisal.</li>
          <li><strong>Legal fees:</strong> $800 to $1,500 for a lawyer to register the new mortgage.</li>
          <li><strong>Discharge fee:</strong> $200 to $350 to remove the existing mortgage from title.</li>
        </ul>
        <p>As a rough guideline, total refinancing costs (excluding the penalty) typically run $1,500 to $3,000. The prepayment penalty is the big variable &mdash; ask your current lender for the exact amount before you commit.</p>

        <h2>Breaking Your Mortgage: The Prepayment Penalty</h2>
        <p>The prepayment penalty is the single biggest cost of refinancing mid-term. Here's how it works:</p>
        <p><strong>Variable-rate mortgages:</strong> The penalty is almost always 3 months' interest on your remaining balance. On a $400,000 balance at 5%, that's roughly $5,000.</p>
        <p><strong>Fixed-rate mortgages:</strong> The penalty is the greater of 3 months' interest or the IRD. The IRD compares your current rate to the lender's current rate for the remaining term. If rates have dropped significantly since you signed, the IRD can be very large &mdash; sometimes $10,000 to $30,000 or more.</p>
        <p>The best time to refinance without a penalty is at renewal, when your term expires. If you're within 120 days of renewal, many lenders will waive the penalty entirely.</p>

        <h2>When Does Refinancing Make Sense?</h2>
        <p>Refinancing makes financial sense when the long-term savings outweigh the upfront costs. Here are some common scenarios:</p>
        <ul>
          <li><strong>Rate savings of 0.5% or more.</strong> If you can reduce your rate by at least half a percentage point, the savings over your term will likely exceed the costs &mdash; especially on larger mortgages.</li>
          <li><strong>Debt consolidation with significant high-interest debt.</strong> If you're paying 20% on $30,000 in credit card debt, rolling it into a 5% mortgage saves you roughly $4,500 per year in interest alone.</li>
          <li><strong>Home renovations that increase value.</strong> Borrowing against equity at 5% for a renovation that increases your home's value by more than the cost is a smart financial move.</li>
          <li><strong>Your renewal is coming up.</strong> This is the ideal time to refinance &mdash; no penalty, and you can shop the market for the best rate and terms.</li>
        </ul>

        <h2>The Refinancing Process: Step by Step</h2>
        <ul>
          <li><strong>Step 1: Crunch the numbers.</strong> Use our refinance calculator to estimate your new payment, savings, and break-even point.</li>
          <li><strong>Step 2: Get your penalty amount.</strong> Call your current lender and ask for your exact prepayment penalty. This is the key number in your decision.</li>
          <li><strong>Step 3: Get pre-approved.</strong> A mortgage broker can shop multiple lenders to find you the best rate and terms for your refinance.</li>
          <li><strong>Step 4: Appraisal.</strong> Your new lender will order a property appraisal to confirm your home's current value.</li>
          <li><strong>Step 5: Legal and closing.</strong> A lawyer handles the discharge of your old mortgage and registration of the new one. This typically takes 2 to 4 weeks.</li>
        </ul>

        <h2>Refinancing vs. HELOC: What's the Difference?</h2>
        <p>Both refinancing and a HELOC (Home Equity Line of Credit) let you access your home equity, but they work differently:</p>
        <ul>
          <li><strong>Refinancing</strong> replaces your entire mortgage with a new one. You get a lump sum, a fixed or variable rate, and regular payments over a set amortization. Best for large, one-time needs like debt consolidation or major renovations.</li>
          <li><strong>A HELOC</strong> is a revolving credit line secured against your home. You can draw and repay as needed, and you only pay interest on what you use. Best for ongoing or flexible needs. HELOC rates are typically higher than mortgage rates.</li>
        </ul>
        <p>In some cases, a combination mortgage + HELOC product gives you the best of both worlds. A broker can help you evaluate which structure fits your situation.</p>

        <h2>Common Refinancing Mistakes to Avoid</h2>
        <ul>
          <li><strong>Not calculating the full cost.</strong> Factor in the penalty, legal fees, appraisal, and any other costs. If the break-even point is longer than your new term, it might not be worth it.</li>
          <li><strong>Extending your amortization without a plan.</strong> Refinancing often resets your amortization to 25 or 30 years. This lowers your payment but increases total interest. If possible, keep your amortization the same or shorter.</li>
          <li><strong>Only talking to your current lender.</strong> Your bank wants to keep your business, but they may not offer the best rate. A mortgage broker shops dozens of lenders on your behalf.</li>
          <li><strong>Consolidating debt without changing habits.</strong> Rolling credit card debt into your mortgage only works if you don't run up the cards again. Have a plan for your spending before you refinance.</li>
        </ul>

        <div class="article__cta-box">
          <h3>Find out how much you could save</h3>
          <p>Get a free refinancing assessment from a licensed mortgage broker. No obligation, no pressure &mdash; just expert advice tailored to your situation.</p>
          <a href="#" class="btn btn--primary btn--large open-modal">Get Pre-Approved</a>
        </div>
      </div>
    </div>
  </article>

  <!-- ======= FOOTER ======= -->
  <footer class="footer">
    <div class="container footer__inner">
      <div class="footer__top">
        <div class="footer__brand">
          <a href="/" class="navbar__logo">
            <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
              <rect width="32" height="32" rx="7" fill="#2A7D5B"/>
              <path d="M7 23V13l9-5.5 9 5.5v10H7z" fill="#1B3C2D"/>
              <rect x="12.5" y="16.5" width="7" height="6.5" rx="1" fill="#F7F3EE"/>
            </svg>
            <span>MyMortgageExpert</span>
          </a>
          <p class="footer__tagline">Helping Canadians find the best mortgage rates since 2019.</p>
        </div>
        <div class="footer__links">
          <div class="footer__col">
            <h4>About Us</h4>
            <a href="/about.html">Our Story</a>
            <a href="/how-it-works.html">How It Works</a>
            <a href="#" class="open-contact-modal">Contact</a>
          </div>
          <div class="footer__col">
            <h4>Resources</h4>
            <a href="/guides/first-time-home-buyer.html">First-Time Buyer Guide</a>
            <a href="/guides/refinancing-your-mortgage.html">Refinancing Guide</a>
            <a href="/guides/mortgage-renewal.html">Mortgage Renewal Guide</a>
          </div>
          <div class="footer__col">
            <h4>Calculators</h4>
            <a href="/calculators/heloc.html">HELOC Calculator</a>
            <a href="/calculators/refinance.html">Refinance</a>
            <a href="/calculators/renewal.html">Renewal</a>
            <a href="/calculators/purchase.html">Purchase Calculator</a>
          </div>
          <div class="footer__col">
            <h4>Legal</h4>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Accessibility</a>
            <a href="#">Disclaimer</a>
          </div>
        </div>
      </div>
      <div class="footer__bottom">
        <p>&copy; 2026 MyMortgageExpert. All rights reserved.</p>
        <div class="footer__legal">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- ======= PRE-APPROVAL MODAL ======= -->
  <div class="modal-overlay" id="preApprovalModal">
    <div class="modal" id="preApprovalModalInner">
      <button class="modal__close" id="modalClose" aria-label="Close">&times;</button>
      <div class="help-progress">
        <div class="help-progress__fill" id="preApprovalProgress" style="width:50%"></div>
      </div>

      <!-- Page 1: Mortgage Details -->
      <div class="help-page active" id="preApprovalPage1">
        <h2 class="modal__title">Get Pre-Approved</h2>
        <p class="modal__subtitle">Tell us about your situation so we can match you with the right broker.</p>
        <form class="modal__form" id="preApprovalForm1">
          <div class="form-group">
            <label for="paGoal">How can we help?</label>
            <select id="paGoal" required>
              <option value="" disabled selected>Select an option</option>
              <option value="HELOC">HELOC</option>
              <option value="Refinance">Refinance</option>
              <option value="Debt Consolidation">Debt Consolidation</option>
              <option value="Power of Sale Help">Power of Sale Help</option>
              <option value="Home Purchase">Home Purchase</option>
              <option value="Lower My Mortgage Rate">Lower My Mortgage Rate</option>
            </select>
          </div>
          <div class="form-group">
            <label for="paPropertyValue">Estimated property value</label>
            <input type="text" id="paPropertyValue" placeholder="$500,000" inputmode="numeric" required>
          </div>
          <div class="form-group">
            <label for="paBalance">Current mortgage balance</label>
            <input type="text" id="paBalance" placeholder="$350,000" inputmode="numeric" required>
          </div>
          <div class="form-group">
            <label for="paRate">Current rate (%)</label>
            <input type="text" id="paRate" placeholder="5.49" inputmode="decimal" required>
          </div>
          <div class="form-group">
            <label>Do you have a 2nd Mortgage or HELOC currently?</label>
            <div class="heloc__toggle" id="paSecondMortgage">
              <button type="button" class="heloc__toggle-btn" data-value="Yes">Yes</button>
              <button type="button" class="heloc__toggle-btn active" data-value="No">No</button>
            </div>
          </div>
          <div class="form-group" id="paSecondMortgageAmountGroup" style="display:none;">
            <label for="paSecondMortgageAmount">2nd Mortgage / HELOC balance</label>
            <input type="text" id="paSecondMortgageAmount" placeholder="$50,000" inputmode="numeric">
          </div>
          <div class="form-group">
            <label>Are you behind on any payments?</label>
            <div class="heloc__toggle" id="paBehind">
              <button type="button" class="heloc__toggle-btn" data-value="Yes">Yes</button>
              <button type="button" class="heloc__toggle-btn active" data-value="No">No</button>
            </div>
          </div>
          <div class="form-group" id="paBehindAmountGroup" style="display:none;">
            <label for="paBehindAmount">How much are you behind?</label>
            <input type="text" id="paBehindAmount" placeholder="$5,000" inputmode="numeric">
          </div>
          <div class="form-group">
            <label for="paBorrow">How much do you want to borrow?</label>
            <input type="text" id="paBorrow" placeholder="$100,000" inputmode="numeric" required>
          </div>
          <button type="submit" class="btn btn--primary btn--large modal__submit">Next</button>
        </form>
      </div>

      <!-- Page 2: Contact Info -->
      <div class="help-page" id="preApprovalPage2">
        <h2 class="modal__title">Almost There!</h2>
        <p class="modal__subtitle">Enter your contact details so we can connect you with a specialist.</p>
        <form class="modal__form" id="preApprovalForm2">
          <div class="modal__row">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" placeholder="First Name" required>
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" placeholder="Last Name" required>
            </div>
          </div>
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" placeholder="(555) 555-5555" required>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="you@example.com" required>
          </div>
          <button type="submit" class="btn btn--primary btn--large modal__submit">Find Your Broker</button>
        </form>
        <p class="modal__disclosure">By providing your contact information, you authorize the broker to contact you about your inquiry. MyMortgageExpert does not provide any mortgage services and is not responsible for any services offered by the broker.</p>
      </div>
    </div>
  </div>

  <!-- ======= CONTACT MODAL ======= -->
  <div class="modal-overlay" id="contactModal">
    <div class="modal">
      <button class="modal__close" id="contactModalClose" aria-label="Close">&times;</button>
      <h2 class="modal__title">Contact Us</h2>
      <p class="modal__subtitle">Have a question? Send us a message and we'll get back to you.</p>
      <form class="modal__form" id="contactForm">
        <div class="form-group">
          <label for="contactName">Name</label>
          <input type="text" id="contactName" placeholder="Your Name" required>
        </div>
        <div class="form-group">
          <label for="contactPhone">Phone Number</label>
          <input type="tel" id="contactPhone" placeholder="(555) 555-5555" required>
        </div>
        <div class="form-group">
          <label for="contactEmail">Email</label>
          <input type="email" id="contactEmail" placeholder="you@example.com" required>
        </div>
        <div class="form-group">
          <label for="contactComments">Comments</label>
          <textarea id="contactComments" rows="4" placeholder="How can we help?" required style="width:100%; padding:12px 14px; border:1.5px solid var(--border); border-radius:var(--radius-md); font-family:inherit; font-size:0.92rem; resize:vertical;"></textarea>
        </div>
        <p class="modal__disclosure" style="margin-bottom:16px;">By sending this message you consent to MyMortgageExpert collecting your personal information to respond to your inquiry. We will not share your information with third parties.</p>
        <button type="submit" class="btn btn--primary btn--large modal__submit">Send Message</button>
      </form>
    </div>
  </div>

  <script>
    // Mobile menu
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('navLinks');
    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navLinks.classList.toggle('active');
    });
    navLinks.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navLinks.classList.remove('active');
      });
    });

    // Navbar dropdown (mobile)
    document.querySelectorAll('.navbar__dropdown-toggle').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        btn.parentElement.classList.toggle('active');
      });
    });

    // Modal
    const modal = document.getElementById('preApprovalModal');
    const modalClose = document.getElementById('modalClose');
    document.querySelectorAll('.open-modal').forEach(btn => {
      btn.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        return false;
      };
    });

    modalClose.addEventListener('click', () => {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (modal.classList.contains('active')) { modal.classList.remove('active'); document.body.style.overflow = ''; }
        if (contactModal.classList.contains('active')) { contactModal.classList.remove('active'); document.body.style.overflow = ''; }
      }
    });

    // Contact modal
    var contactModal = document.getElementById('contactModal');
    var contactModalClose = document.getElementById('contactModalClose');
    document.querySelectorAll('.open-contact-modal').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        contactModal.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });
    contactModalClose.addEventListener('click', function() { contactModal.classList.remove('active'); document.body.style.overflow = ''; });
    contactModal.addEventListener('click', function(e) { if (e.target === contactModal) { contactModal.classList.remove('active'); document.body.style.overflow = ''; } });
    document.getElementById('contactForm').addEventListener('submit', function(e) {
      e.preventDefault();
      var cName = document.getElementById('contactName').value;
      var cPhone = document.getElementById('contactPhone').value;
      var cEmail = document.getElementById('contactEmail').value;
      var cComments = document.getElementById('contactComments').value;
      (async function() { var brokerId = await fetchActiveBrokerId(); await submitLead({ first_name: cName, last_name: '', email: cEmail, phone: cPhone, source: 'contact', page: window.location.pathname, broker_id: brokerId, notes: cComments }); })();
      e.target.closest('.modal').innerHTML = '<button class="modal__close" id="contactModalCloseSuccess" aria-label="Close">&times;</button><div style="text-align:center; padding:40px 20px;"><h2 class="modal__title">Message Sent</h2><p class="modal__subtitle">Thanks, ' + cName + '. We\'ll be in touch shortly.</p></div>';
      document.getElementById('contactModalCloseSuccess').addEventListener('click', function() { contactModal.classList.remove('active'); document.body.style.overflow = ''; });
    });

    var broker = {
      name: 'Lighthouse Lending',
      phone: '905-234-3323',
      phoneTel: '19052343323',
      licence: 'FSRA# 13301',
      logo: '../lighthouse-lending-logo.png'
    };

    // Pre-approval wizard: Page 1 → Page 2
    document.getElementById('preApprovalForm1').addEventListener('submit', function(e) {
      e.preventDefault();
      document.getElementById('preApprovalPage1').classList.remove('active');
      document.getElementById('preApprovalPage2').classList.add('active');
      document.getElementById('preApprovalProgress').style.width = '100%';
    });

    // Yes/No toggles with conditional amount fields
    var toggleAmountMap = {
      paSecondMortgage: { group: 'paSecondMortgageAmountGroup', input: 'paSecondMortgageAmount' },
      paBehind: { group: 'paBehindAmountGroup', input: 'paBehindAmount' }
    };
    ['paSecondMortgage', 'paBehind'].forEach(function(id) {
      document.getElementById(id).addEventListener('click', function(e) {
        var btn = e.target.closest('.heloc__toggle-btn');
        if (!btn) return;
        this.querySelectorAll('.heloc__toggle-btn').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        var map = toggleAmountMap[id];
        if (btn.dataset.value === 'Yes') {
          document.getElementById(map.group).style.display = '';
        } else {
          document.getElementById(map.group).style.display = 'none';
          document.getElementById(map.input).value = '';
        }
      });
    });

    // Currency formatting on page 1 inputs
    ['paPropertyValue', 'paBalance', 'paBorrow', 'paSecondMortgageAmount', 'paBehindAmount'].forEach(function(id) {
      document.getElementById(id).addEventListener('input', function() {
        var raw = this.value.replace(/[^0-9]/g, '');
        if (raw === '') { this.value = ''; return; }
        this.value = '$' + Number(raw).toLocaleString('en-CA');
      });
    });

    // Pre-approval wizard: Page 2 submit
    document.getElementById('preApprovalForm2').addEventListener('submit', function(e) {
      e.preventDefault();
      var firstName = document.getElementById('firstName').value;
      var lastName = document.getElementById('lastName').value;
      var phone = document.getElementById('phone').value;
      var email = document.getElementById('email').value;

      // Gather page 1 data
      var goal = document.getElementById('paGoal').value;
      var propertyValue = document.getElementById('paPropertyValue').value;
      var balance = document.getElementById('paBalance').value;
      var rate = document.getElementById('paRate').value;
      var secondMortgage = document.querySelector('#paSecondMortgage .heloc__toggle-btn.active').dataset.value;
      var secondMortgageAmt = document.getElementById('paSecondMortgageAmount').value || 'N/A';
      var behind = document.querySelector('#paBehind .heloc__toggle-btn.active').dataset.value;
      var behindAmt = document.getElementById('paBehindAmount').value || 'N/A';
      var borrow = document.getElementById('paBorrow').value;

      (async function() {
        var brokerId = await fetchActiveBrokerId();
        await submitLead({
          first_name: firstName, last_name: lastName, email: email, phone: phone,
          source: 'pre-approval', page: window.location.pathname,
          broker_id: brokerId,
          notes: 'Goal: ' + goal + ' | Property Value: ' + propertyValue + ' | Balance: ' + balance + ' | Rate: ' + rate + '% | 2nd Mortgage/HELOC: ' + secondMortgage + (secondMortgage === 'Yes' ? ' (' + secondMortgageAmt + ')' : '') + ' | Behind on Payments: ' + behind + (behind === 'Yes' ? ' (' + behindAmt + ')' : '') + ' | Want to Borrow: ' + borrow
        });
      })();

      var modalEl = document.getElementById('preApprovalModalInner');
      modalEl.innerHTML = '<button class="modal__close" id="modalCloseLoading" aria-label="Close">&times;</button>' +
        '<div class="help-loading">' +
          '<div class="help-loading__spinner"></div>' +
          '<h2 class="help-loading__text">Pairing you with the best Broker</h2>' +
        '</div>';
      document.getElementById('modalCloseLoading').addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      });
      setTimeout(function() {
        modalEl.innerHTML = '<button class="modal__close" id="modalCloseResult" aria-label="Close">&times;</button>' +
          '<div class="broker-result">' +
            '<h2 class="broker-result__heading">You\'ve Been Matched!</h2>' +
            '<p class="broker-result__subtext">' + firstName + ', here is your matched broker:</p>' +
            '<img class="broker-result__logo" src="' + broker.logo + '" alt="' + broker.name + '">' +
            '<h3 class="broker-result__name">' + broker.name + '</h3>' +
            '<div class="broker-result__info">' +
              '<span>' + broker.phone + '</span>' +
              '<span>' + broker.licence + '</span>' +
            '</div>' +
            '<a href="tel:' + broker.phoneTel + '" class="btn btn--primary btn--large broker-result__cta">Call Now</a>' +
          '</div>';
        document.getElementById('modalCloseResult').addEventListener('click', function() {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        });
      }, 3000);
    });

    // Navbar scroll shadow
    const navbar = document.getElementById('navbar');
    window.addEventListener('scroll', () => {
      navbar.style.boxShadow = window.scrollY > 10 ? '0 2px 16px rgba(0,0,0,0.06)' : 'none';
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../supabase-config.js"></script>
  <script>
    (async function() {
      const b = await fetchBroker();
      if (b) { broker.name = b.name; broker.phone = b.phone; broker.phoneTel = b.phoneTel; broker.licence = b.licence; broker.logo = '../' + b.logo; }
    })();
  </script>
</body>
</html>
