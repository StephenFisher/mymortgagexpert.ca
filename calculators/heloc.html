<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HELOC Calculator â€” MyMortgageExpert</title>
  <meta name="description" content="Calculate your HELOC borrowing power and monthly payments. Free Canadian home equity line of credit calculator with current rates.">
  <link rel="stylesheet" href="../styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@800&family=Playfair+Display:ital,wght@1,600;1,700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- ======= NAV BAR ======= -->
  <header class="navbar" id="navbar">
    <div class="container navbar__inner">
      <a href="/" class="navbar__logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="7" fill="#1B3C2D"/>
          <path d="M7 23V13l9-5.5 9 5.5v10H7z" fill="#2A7D5B"/>
          <rect x="12.5" y="16.5" width="7" height="6.5" rx="1" fill="#F7F3EE"/>
        </svg>
        <span>MyMortgageExpert</span>
      </a>
      <nav class="navbar__links" id="navLinks">
        <div class="navbar__dropdown">
          <button class="navbar__dropdown-toggle">Calculators <svg width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
          <div class="navbar__dropdown-menu">
            <a href="/calculators/heloc.html">HELOC Calculator</a>
            <a href="/calculators/refinance.html">Refinance Calculator</a>
            <a href="/calculators/renewal.html">Renewal Calculator</a>
            <a href="/calculators/home-equity-loan.html">Home Equity Loan Calculator</a>
            <a href="/calculators/self-employed.html">Self-Employed Calculator</a>
            <a href="/calculators/land-transfer-tax.html">Land Transfer Tax Calculator</a>
            <a href="/calculators/purchase.html">Purchase Calculator</a>
            <a href="/calculators/affordability.html">Affordability Calculator</a>
          </div>
        </div>
        <a href="/mortgages.html">Mortgages</a>
        <a href="/how-it-works.html">How It Works</a>
        <a href="/about.html">About Us</a>
        <a href="#" class="btn btn--primary navbar__mobile-cta open-modal">Get Pre-Approved</a>
      </nav>
      <div class="navbar__right">
        <a href="#" class="btn btn--primary navbar__cta open-modal">Get Pre-Approved</a>
      </div>
      <button class="navbar__hamburger" id="hamburger" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <!-- ======= HELOC CALCULATOR ======= -->
  <section class="heloc">
    <div class="container">
      <div class="heloc__nav">
        <a href="/" class="heloc__back">&larr; Back to Home</a>
      </div>

      <div class="heloc__header">
        <span class="heloc__tag">CALCULATOR</span>
        <h1 class="heloc__title">HELOC Calculator</h1>
        <p class="heloc__subtitle">Estimate your Home Equity Line of Credit limit, monthly payment, and potential savings from debt consolidation.</p>
      </div>

      <div class="heloc__layout">
        <!-- LEFT: Input Form -->
        <div class="heloc__form-card">
          <h3 class="heloc__form-title">Your Property Details</h3>
          <div class="heloc__form">
            <div class="form-group">
              <label for="helocHomeValue">Estimated Home Value</label>
              <input type="text" id="helocHomeValue" value="" placeholder="$950,000" inputmode="numeric">
              <span class="heloc__helper">Enter the current estimated value of your home</span>
            </div>
            <div class="form-group">
              <label for="helocMortgageBalance">Existing Mortgage Balance</label>
              <input type="text" id="helocMortgageBalance" value="" placeholder="$450,000" inputmode="numeric">
              <span class="heloc__helper">Enter your outstanding mortgage amount</span>
            </div>
            <div class="form-group">
              <label for="helocBorrowAmount">How Much Would You Like to Borrow?</label>
              <input type="text" id="helocBorrowAmount" value="" placeholder="$100,000" inputmode="numeric">
              <span class="heloc__helper">Enter the amount you would like to access from your equity</span>
            </div>
            <div class="form-group">
              <label>Would You Like to Consolidate Debt?</label>
              <div class="heloc__toggle" id="helocConsolidateToggle">
                <button type="button" class="heloc__toggle-btn active" data-value="no">No</button>
                <button type="button" class="heloc__toggle-btn" data-value="yes">Yes</button>
              </div>
            </div>
            <div class="form-group" id="helocDebtField" style="display:none;">
              <label for="helocDebtAmount">Amount of Debt to Consolidate</label>
              <input type="text" id="helocDebtAmount" value="" placeholder="$0" inputmode="numeric">
              <span class="heloc__helper">Total credit cards, unsecured debt, and outstanding taxes to pay off</span>
            </div>
          </div>
        </div>

        <!-- RIGHT: Results Card -->
        <div class="heloc__results-card" id="helocResults">
          <div class="heloc__results-inner">
          <h3 class="heloc__results-title">Your HELOC Estimate</h3>

          <div class="heloc__result-row">
            <span class="heloc__result-label">Maximum HELOC Limit</span>
            <span class="heloc__result-value" id="resultMaxLimit">$0</span>
          </div>
          <div class="heloc__result-divider"></div>

          <div class="heloc__result-row">
            <span class="heloc__result-label">Your HELOC Amount</span>
            <span class="heloc__result-value heloc__result-value--highlight" id="resultHelocAmount">$0</span>
          </div>
          <div class="heloc__result-divider"></div>

          <div class="heloc__result-row">
            <span class="heloc__result-label">New Monthly Payment</span>
            <span class="heloc__result-value" id="resultMonthlyPayment">$0</span>
          </div>

          <!-- Consolidation results (hidden by default) -->
          <div id="helocConsolidationResults" style="display:none;">
            <div class="heloc__result-divider"></div>
            <div class="heloc__result-row">
              <span class="heloc__result-label">Current Monthly Debt Payment*</span>
              <span class="heloc__result-value" id="resultCurrentDebt">$0</span>
            </div>
            <div class="heloc__result-divider"></div>
            <div class="heloc__result-row">
              <span class="heloc__result-label">Monthly Savings</span>
              <span class="heloc__result-value heloc__result-value--savings" id="resultMonthlySavings">$0</span>
            </div>
            <div class="heloc__result-divider"></div>
            <div class="heloc__result-row">
              <span class="heloc__result-label">Estimated Annual Savings</span>
              <span class="heloc__result-value heloc__result-value--savings" id="resultAnnualSavings">$0</span>
            </div>
          </div>

          <!-- Warning (hidden by default) -->
          <div class="heloc__warning" id="helocWarning" style="display:none;">
            Your requested amount exceeds your available HELOC limit. Please adjust your inputs.
          </div>

          <a href="#" class="btn btn--white btn--large heloc__results-cta open-modal">Speak to a Specialist</a>
          <p class="heloc__results-disclosure">* Current monthly debt payment is an estimate based on the information provided.<br>These numbers represent a non-binding estimate. Rates and terms subject to approval.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ======= EDUCATIONAL CONTENT ======= -->
  <section class="heloc-info">
    <div class="container heloc-info__container">
      <div class="heloc-info__body">
        <h2>What Is a HELOC?</h2>
        <p>A Home Equity Line of Credit (HELOC) is a revolving credit facility secured by your home. Unlike a traditional mortgage or home equity loan, a HELOC allows you to borrow funds as needed up to a pre-approved limit, paying interest only on the amount you actually use.</p>

        <h2>How Does a HELOC Work?</h2>
        <p>Your HELOC limit is based on your home's appraised value minus your existing mortgage balance. In Canada, most lenders allow you to borrow up to 80% of your home's value (loan-to-value ratio), less any outstanding mortgage balance.</p>
        <ul>
          <li><strong>Revolving credit:</strong> Borrow, repay, and borrow again up to your limit &mdash; similar to a credit card but with much lower interest rates.</li>
          <li><strong>Interest-only payments:</strong> Most HELOCs require interest-only payments on the drawn amount, keeping monthly costs lower.</li>
          <li><strong>Variable rate:</strong> HELOC rates are typically variable, tied to the lender's prime rate.</li>
        </ul>

        <h2>HELOC for Debt Consolidation</h2>
        <p>One of the most popular uses of a HELOC is consolidating high-interest debt. By rolling credit card balances (often at 19%+ interest) into a HELOC at a much lower rate, homeowners can save thousands of dollars per year in interest charges while simplifying their monthly payments into a single payment.</p>

        <h2>Who Qualifies for a HELOC?</h2>
        <p>To qualify for a HELOC in Canada, you typically need:</p>
        <ul>
          <li><strong>At least 20% equity:</strong> Your home's value must exceed your mortgage balance by enough to provide borrowing room.</li>
          <li><strong>Good credit history:</strong> Most lenders require a minimum credit score, though requirements vary.</li>
          <li><strong>Stable income:</strong> Proof of income sufficient to service the HELOC payments alongside your existing mortgage.</li>
        </ul>

        <div class="article__cta-box">
          <h3>Ready to unlock your home equity?</h3>
          <p>Speak with a licensed mortgage specialist to find out how much you could access through a HELOC. No obligation, no credit check required.</p>
          <a href="#" class="btn btn--primary btn--large open-modal">Speak to a Specialist</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ======= FOOTER ======= -->
  <footer class="footer">
    <div class="container footer__inner">
      <div class="footer__top">
        <div class="footer__brand">
          <a href="/" class="navbar__logo">
            <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
              <rect width="32" height="32" rx="7" fill="#2A7D5B"/>
              <path d="M7 23V13l9-5.5 9 5.5v10H7z" fill="#1B3C2D"/>
              <rect x="12.5" y="16.5" width="7" height="6.5" rx="1" fill="#F7F3EE"/>
            </svg>
            <span>MyMortgageExpert</span>
          </a>
          <p class="footer__tagline">Helping Canadians find the best mortgage rates since 2019.</p>
        </div>
        <div class="footer__links">
          <div class="footer__col">
            <h4>About Us</h4>
            <a href="/about.html">Our Story</a>
            <a href="/how-it-works.html">How It Works</a>
            <a href="#" class="open-contact-modal">Contact</a>
          </div>
          <div class="footer__col">
            <h4>Resources</h4>
            <a href="/guides/first-time-home-buyer.html">First-Time Buyer Guide</a>
            <a href="/guides/refinancing-your-mortgage.html">Refinancing Guide</a>
            <a href="/guides/mortgage-renewal.html">Mortgage Renewal Guide</a>
          </div>
          <div class="footer__col">
            <h4>Calculators</h4>
            <a href="/calculators/heloc.html">HELOC Calculator</a>
            <a href="/calculators/refinance.html">Refinance</a>
            <a href="/calculators/renewal.html">Renewal</a>
            <a href="/calculators/purchase.html">Purchase Calculator</a>
          </div>
          <div class="footer__col">
            <h4>Legal</h4>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Accessibility</a>
            <a href="#">Disclaimer</a>
          </div>
        </div>
      </div>
      <div class="footer__bottom">
        <p>&copy; 2026 MyMortgageExpert. All rights reserved.</p>
        <div class="footer__legal">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- ======= SPECIALIST MODAL ======= -->
  <div class="modal-overlay" id="preApprovalModal">
    <div class="modal" id="preApprovalModalInner">
      <button class="modal__close" id="modalClose" aria-label="Close">&times;</button>
      <h2 class="modal__title">Speak to a Specialist</h2>
      <p class="modal__subtitle">Enter your details and we'll connect you with a licensed mortgage broker.</p>
      <form class="modal__form" id="specialistForm">
        <div class="form-group">
          <label for="specName">Name</label>
          <input type="text" id="specName" placeholder="Your Name" required>
        </div>
        <div class="form-group">
          <label for="specPhone">Phone Number</label>
          <input type="tel" id="specPhone" placeholder="(555) 555-5555" required>
        </div>
        <div class="form-group">
          <label for="specEmail">Email</label>
          <input type="email" id="specEmail" placeholder="you@example.com" required>
        </div>
        <p class="modal__disclosure" style="margin-bottom:12px;">By clicking below you consent to being contacted by a licensed broker.</p>
        <button type="submit" class="btn btn--primary btn--large modal__submit">Connect Me With My Broker</button>
      </form>
    </div>
  </div>

  <!-- ======= CONTACT MODAL ======= -->
  <div class="modal-overlay" id="contactModal">
    <div class="modal">
      <button class="modal__close" id="contactModalClose" aria-label="Close">&times;</button>
      <h2 class="modal__title">Contact Us</h2>
      <p class="modal__subtitle">Have a question? Send us a message and we'll get back to you.</p>
      <form class="modal__form" id="contactForm">
        <div class="form-group">
          <label for="contactName">Name</label>
          <input type="text" id="contactName" placeholder="Your Name" required>
        </div>
        <div class="form-group">
          <label for="contactPhone">Phone Number</label>
          <input type="tel" id="contactPhone" placeholder="(555) 555-5555" required>
        </div>
        <div class="form-group">
          <label for="contactEmail">Email</label>
          <input type="email" id="contactEmail" placeholder="you@example.com" required>
        </div>
        <div class="form-group">
          <label for="contactComments">Comments</label>
          <textarea id="contactComments" rows="4" placeholder="How can we help?" required style="width:100%; padding:12px 14px; border:1.5px solid var(--border); border-radius:var(--radius-md); font-family:inherit; font-size:0.92rem; resize:vertical;"></textarea>
        </div>
        <p class="modal__disclosure" style="margin-bottom:16px;">By sending this message you consent to MyMortgageExpert collecting your personal information to respond to your inquiry. We will not share your information with third parties.</p>
        <button type="submit" class="btn btn--primary btn--large modal__submit">Send Message</button>
      </form>
    </div>
  </div>

  <script>
    // ===========================
    // Mobile Menu
    // ===========================
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('navLinks');
    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navLinks.classList.toggle('active');
    });
    navLinks.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navLinks.classList.remove('active');
      });
    });

    // ===========================
    // Pre-Approval Modal
    // ===========================
    const modal = document.getElementById('preApprovalModal');
    const modalClose = document.getElementById('modalClose');
    document.querySelectorAll('.open-modal').forEach(btn => {
      btn.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        return false;
      };
    });

    modalClose.addEventListener('click', () => {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (modal.classList.contains('active')) { modal.classList.remove('active'); document.body.style.overflow = ''; }
        if (contactModal.classList.contains('active')) { contactModal.classList.remove('active'); document.body.style.overflow = ''; }
      }
    });

    // Contact modal
    var contactModal = document.getElementById('contactModal');
    var contactModalClose = document.getElementById('contactModalClose');
    document.querySelectorAll('.open-contact-modal').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        contactModal.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });
    contactModalClose.addEventListener('click', function() { contactModal.classList.remove('active'); document.body.style.overflow = ''; });
    contactModal.addEventListener('click', function(e) { if (e.target === contactModal) { contactModal.classList.remove('active'); document.body.style.overflow = ''; } });
    document.getElementById('contactForm').addEventListener('submit', function(e) {
      e.preventDefault();
      var cName = document.getElementById('contactName').value;
      var cPhone = document.getElementById('contactPhone').value;
      var cEmail = document.getElementById('contactEmail').value;
      var cComments = document.getElementById('contactComments').value;
      (async function() { var brokerId = await fetchActiveBrokerId(); await submitLead({ first_name: cName, last_name: '', email: cEmail, phone: cPhone, source: 'contact', page: window.location.pathname, broker_id: brokerId, notes: cComments }); })();
      e.target.closest('.modal').innerHTML = '<button class="modal__close" id="contactModalCloseSuccess" aria-label="Close">&times;</button><div style="text-align:center; padding:40px 20px;"><h2 class="modal__title">Message Sent</h2><p class="modal__subtitle">Thanks, ' + cName + '. We\'ll be in touch shortly.</p></div>';
      document.getElementById('contactModalCloseSuccess').addEventListener('click', function() { contactModal.classList.remove('active'); document.body.style.overflow = ''; });
    });

    var broker = {
      name: 'Lighthouse Lending',
      phone: '905-234-3323',
      phoneTel: '19052343323',
      licence: 'FSRA# 13301',
      logo: '../lighthouse-lending-logo.png'
    };

    function getCalculatorData() {
      return {
        type: 'heloc',
        inputs: {
          homeValue: document.getElementById('helocHomeValue').value,
          mortgageBalance: document.getElementById('helocMortgageBalance').value,
          borrowAmount: document.getElementById('helocBorrowAmount').value,
          consolidateDebt: document.querySelector('#helocConsolidateToggle .heloc__toggle-btn.active') ? document.querySelector('#helocConsolidateToggle .heloc__toggle-btn.active').textContent : 'No',
          debtAmount: document.getElementById('helocDebtAmount').value || 'N/A'
        },
        results: {
          maxLimit: document.getElementById('resultMaxLimit').textContent,
          helocAmount: document.getElementById('resultHelocAmount').textContent,
          monthlyPayment: document.getElementById('resultMonthlyPayment').textContent,
          currentDebtPayment: document.getElementById('resultCurrentDebt').textContent,
          monthlySavings: document.getElementById('resultMonthlySavings').textContent,
          annualSavings: document.getElementById('resultAnnualSavings').textContent
        }
      };
    }

    // Specialist form submit
    document.getElementById('specialistForm').addEventListener('submit', function(e) {
      e.preventDefault();
      var name = document.getElementById('specName').value;
      var phone = document.getElementById('specPhone').value;
      var email = document.getElementById('specEmail').value;

      // Gather calculator data for lead notes
      var calcData = typeof getCalculatorData === 'function' ? getCalculatorData() : {};
      var notes = '';
      if (calcData.inputs) {
        notes = Object.keys(calcData.inputs).map(function(k) { return k + ': ' + calcData.inputs[k]; }).join(' | ');
      }
      if (calcData.results) {
        notes += (notes ? ' || Results: ' : 'Results: ') + Object.keys(calcData.results).map(function(k) { return k + ': ' + calcData.results[k]; }).join(' | ');
      }

      (async function() {
        var brokerId = await fetchActiveBrokerId();
        await submitLead({
          first_name: name, last_name: '', email: email, phone: phone,
          source: 'calculator', page: window.location.pathname,
          broker_id: brokerId,
          notes: notes
        });
      })();

      var modalEl = document.getElementById('preApprovalModalInner');
      modalEl.innerHTML = '<button class="modal__close" id="modalCloseLoading" aria-label="Close">&times;</button>' +
        '<div class="help-loading">' +
          '<div class="help-loading__spinner"></div>' +
          '<h2 class="help-loading__text">Pairing you with the best Broker</h2>' +
        '</div>';
      document.getElementById('modalCloseLoading').addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      });
      setTimeout(function() {
        modalEl.innerHTML = '<button class="modal__close" id="modalCloseResult" aria-label="Close">&times;</button>' +
          '<div class="broker-result">' +
            '<h2 class="broker-result__heading">You\'ve Been Matched!</h2>' +
            '<p class="broker-result__subtext">' + name + ', here is your matched broker:</p>' +
            '<img class="broker-result__logo" src="' + broker.logo + '" alt="' + broker.name + '">' +
            '<h3 class="broker-result__name">' + broker.name + '</h3>' +
            '<div class="broker-result__info">' +
              '<span>' + broker.phone + '</span>' +
              '<span>' + broker.licence + '</span>' +
            '</div>' +
            '<a href="tel:' + broker.phoneTel + '" class="btn btn--primary btn--large broker-result__cta">Call Now</a>' +
          '</div>';
        document.getElementById('modalCloseResult').addEventListener('click', function() {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        });
      }, 3000);
    });

    // Navbar scroll shadow
    const navbar = document.getElementById('navbar');
    window.addEventListener('scroll', () => {
      navbar.style.boxShadow = window.scrollY > 10 ? '0 2px 16px rgba(0,0,0,0.06)' : 'none';
    });

    // ===========================
    // HELOC Calculator
    // ===========================
    const HELOC_LTV = 0.80;
    var HELOC_RATE = 0.0495;
    const UNSECURED_RATE = 0.19;

    const homeValueInput = document.getElementById('helocHomeValue');
    const mortgageBalanceInput = document.getElementById('helocMortgageBalance');
    const borrowAmountInput = document.getElementById('helocBorrowAmount');
    const debtAmountInput = document.getElementById('helocDebtAmount');
    const consolidateToggle = document.getElementById('helocConsolidateToggle');
    const debtField = document.getElementById('helocDebtField');
    const consolidationResults = document.getElementById('helocConsolidationResults');
    const warningEl = document.getElementById('helocWarning');

    const resultMaxLimit = document.getElementById('resultMaxLimit');
    const resultHelocAmount = document.getElementById('resultHelocAmount');
    const resultMonthlyPayment = document.getElementById('resultMonthlyPayment');
    const resultCurrentDebt = document.getElementById('resultCurrentDebt');
    const resultMonthlySavings = document.getElementById('resultMonthlySavings');
    const resultAnnualSavings = document.getElementById('resultAnnualSavings');

    let consolidateDebt = false;

    function formatCurrency(value) {
      return '$' + Math.round(value).toLocaleString('en-CA');
    }

    function parseCurrency(str) {
      return Number(str.replace(/[^0-9]/g, '')) || 0;
    }

    function bindCurrencyFormat(input) {
      function handle() {
        const raw = input.value.replace(/[^0-9]/g, '');
        if (raw === '') { input.value = ''; calculate(); return; }
        input.value = '$' + Number(raw).toLocaleString('en-CA');
        calculate();
      }
      input.addEventListener('input', handle);
      input.addEventListener('change', handle);
    }

    [homeValueInput, mortgageBalanceInput, borrowAmountInput, debtAmountInput].forEach(bindCurrencyFormat);

    // Toggle debt consolidation
    consolidateToggle.addEventListener('click', function(e) {
      const btn = e.target.closest('.heloc__toggle-btn');
      if (!btn) return;
      consolidateToggle.querySelectorAll('.heloc__toggle-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      consolidateDebt = btn.dataset.value === 'yes';
      debtField.style.display = consolidateDebt ? '' : 'none';
      consolidationResults.style.display = consolidateDebt ? '' : 'none';
      if (!consolidateDebt) debtAmountInput.value = '';
      calculate();
    });

    // Core calculation
    function calculate() {
      const homeValue = parseCurrency(homeValueInput.value);
      const mortgageBalance = parseCurrency(mortgageBalanceInput.value);
      const borrowAmount = parseCurrency(borrowAmountInput.value);
      const debtAmount = consolidateDebt ? parseCurrency(debtAmountInput.value) : 0;

      const maxLimit = Math.max(0, Math.round((homeValue * HELOC_LTV) - mortgageBalance));
      const exceeds = borrowAmount > maxLimit;
      const helocAmount = (borrowAmount > 0 && !exceeds) ? borrowAmount : 0;
      const helocEffectiveMonthly = Math.pow(1 + HELOC_RATE / 2, 1/6) - 1;
      const monthlyPayment = helocAmount * helocEffectiveMonthly;

      warningEl.style.display = (exceeds && borrowAmount > 0 && homeValue > 0) ? '' : 'none';

      resultMaxLimit.textContent = formatCurrency(maxLimit);
      resultHelocAmount.textContent = formatCurrency(helocAmount);
      resultMonthlyPayment.textContent = formatCurrency(monthlyPayment);

      if (consolidateDebt) {
        const currentMonthlyDebt = debtAmount * (UNSECURED_RATE / 12);
        const newMonthlyDebt = debtAmount * helocEffectiveMonthly;
        const monthlySavings = Math.max(0, currentMonthlyDebt - newMonthlyDebt);
        const annualSavings = monthlySavings * 12;

        resultCurrentDebt.textContent = formatCurrency(currentMonthlyDebt);
        resultMonthlySavings.textContent = formatCurrency(monthlySavings);
        resultAnnualSavings.textContent = formatCurrency(annualSavings);
      }
    }

    calculate();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../supabase-config.js"></script>
  <script>
    (async function() {
      const helocRate = await fetchSingleRate('heloc');
      if (helocRate) { HELOC_RATE = helocRate / 100; calculate(); }
      const b = await fetchBroker();
      if (b) { broker.name = b.name; broker.phone = b.phone; broker.phoneTel = b.phoneTel; broker.licence = b.licence; broker.logo = '../' + b.logo; }
    })();
  </script>
</body>
</html>
